<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compra</title>
    <link href="output.css" rel="stylesheet">
    <link rel="icon" href="./assets/icon/favicon.ico">
</head>

<body class="bg-gradient-to-b from-[#431B19] to-[#1A1919]">

    <header>
		<!--nav principal-->
		<nav class="bg-black max-sm:hidden">
			<ul class="flex justify-end">
				<li><a href="./home.html" class="text-white mr-16 text-xl">Inicio</a></li>
				<li><a href="#" class="text-white mr-16 text-xl" onclick="window.location.href='./busqueda.html'">Peliculas</a></li>
				<li><a href="./cartelera.html" class="text-white mr-16 text-xl">Cartelera</a></li>
			</ul>
		</nav>
		<!--seccion del logo-->
		<section
			class="bg-gradient-to-b from-[#9C6D46] to-[#684A31] flex justify-between px-5 py-0 items-center w-full max-sm:px-0">
			<a href="./home.html" class="cursor-pointer">
                <img src="./assets/img/logo.png" alt="" 
                    class="w-auto h-12 max-sm:h-10 max-sm:w-auto">
            </a>
			<div
				class="user-container flex items-center w-44 h-12 justify-center relative space-x-2 max-sm:m-0 max-sm:space-x-0 max-sm:w-32">
				<div onclick="window.location.href='./perfil-usuario.html'" class="ml-4 cursor-pointer max-sm:ml-0">
					<img src="./assets/icon/usuario.png"
						class="w-auto h-10 max-sm:h-10">
				</div>
				<div class="flex max-sm:hidden">
					<div class="cursor-pointer">
						<p class="text-lg font-semibold">Username</p>
					</div>
					<div onclick="userLogged()" class="absolute right-0 bottom-3 cursor-pointer ">
						<svg class="w-5 h-5 ml-2 -mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
							xmlns="http://www.w3.org/2000/svg">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
							</path>
						</svg>
					</div>
				</div>
				<div id="guest-slide"
					class="absolute w-52 h-44 bg-white top-12 right-[-10px] z-50 rounded-lg text-center hidden">
					<p class="mt-2">Inicie Sesión en Filmania</p>
					<button onclick="window.location.href='./inicio-sesion.html'"
						class="mt-2 bg-[#996c45] w-40 py-2 rounded-full font-bold">Inicie Sesión</button>
					<p class="mt-2">o</p>
					<button onclick="window.location.href='./registro.html'"
						class="mt-2 bg-[#996c45] w-40 py-2 rounded-full font-bold">Registrese</button>
				</div>
				<div id="user-slide"
					class="absolute w-52 h-44 bg-white top-12 right-[-10px] z-50 rounded-lg hidden text-center">
					<p class="mt-2">Bienvenido a Filmania</p>
					<button onclick="window.location.href='./inicio-sesion.html'"
						class="mt-4 bg-[#996c45] w-40 py-2 rounded-full font-bold">Perfil</button>
					<button onclick="window.location.href='./registro.html'"
						class="mt-4 bg-[#996c45] w-40 py-2 rounded-full font-bold">Cerrar Sesión</button>
				</div>
			</div>
		</section>
	</header>


    <main class="flex flex-col items-center h-full bg-gradient-to-b from-[#431B19] to-[#1A1919]
          text-white py-16">

        <h1 class="text-4xl">TU COMPRA</h1>

        <div class="flex justify-around w-11/12 pt-14 items-center flex-wrap ">

            <!--datos-->
            <div class="flex flex-col w-full md:w-2/3  gap-y-2.5 text-lg px-5">
                <p class="text-2xl flex justify-center  pb-4 w-full">
                    Datos de la orden:
                </p>
                <div>
                    <p class="pb-2">Código de confirmación:</p>
                    <p id="compra-confirmacion" class="bg-white h-7 rounded-3xl text-black pl-4"></p>
                </div>
                <div>
                    <p class="pb-2">Sede:</p>
                    <div id="compra-sede" class="bg-white h-7 rounded-3xl text-black pl-4"></div>
                </div>
                <div>
                    <p class="pb-2">Película:</p>
                    <div id="compra-pelicula" class="bg-white h-7 rounded-3xl text-black pl-4"></div>
                </div>

                <div class="flex gap-x-16 flex-wrap">
                    <div class="pb-2">
                        <p class="pb-2">Sala:</p>
                        <div id="compra-sala" class="bg-white h-7 w-48 rounded-3xl text-black pl-4"></div>
                    </div>

                    <div class="pb-2">
                        <p class="pb-2">Fecha:</p>
                        <div id="compra-fecha" class="bg-white h-7 w-48 rounded-3xl text-black pl-4"></div>
                    </div>

                    <div class="pb-2">
                        <p class="pb-2">Hora:</p>
                        <div id="compra-hora" class="bg-white h-7 w-48 rounded-3xl text-black pl-4"></div>
                    </div>
                </div>

                <div>
                    <p class="pb-2">Boletos:</p>
                    <div id="compra-boletos" class="bg-white w-full h-7 rounded-3xl text-black pl-4"></div>
                </div>
                <!--Se elimina transaccion porque nadie sabe que va aqui-->
                <!--
                <div>
                    <p class="pb-2">Transacción:</p>
                    <div id="compra-transaccion" class="bg-white w-full h-7 rounded-3xl text-black pl-4"></div>
                </div>
                -->
                <div class="flex justify-between w-full pt-5">
                    <p>Total de la compra:</p>
                    <p id="compra-total"></p>
                </div>
            </div>

            <!--codigo QR-->
            <div class="border-solid border-1 flex flex-col items-center pt-4">
                <p class="text-2xl pb-2">Escanee su código QR</p>
                <!--habilitar link para pruebas directas en el navegador
                    <a href="#" id="paginaVideo">-->
                    <div id="compra-qrcode"></div>
                <!--</a>-->

            </div>
        </div>
        <button onclick="window.location.href='./home.html'" class="bg-[#9C6D46] flex justify-center items-center text-4xl mt-16 w-52 h-16
            hover:bg-amber-700 active:bg-amber-900 rounded-full">
            HECHO
        </button>

    </main>

    <footer class="bg-gradient-to-b from-[#9C6D46] to-[#684A31] py-5 max-sm:py-6 w-full relative">
        <div id="footerItems" class="max-sm:pr-0">
            <div class="flex pl-36 max-sm:pl-3 space-x-3">
				<div class="space-y-1">
					<div class="flex items-center">
						<img src="./assets/icon/seguro.png" class="w-4 mr-3" />
						<a href="#" class="text-white max-sm:text-sm">Politicas de la Empresa</a>
					</div>
					<div class="flex items-center cursor-pointer" id="chatbot-ayuda-footer">
						<img src="./assets/icon/apoyo (1).png" class="w-4 mr-3" />
						<p class="text-white max-sm:text-sm">Atencion al Cliente</p>
					</div>
				</div>
				<div class="space-y-1">
					<div class="flex items-center">
						<img src="./assets/icon/grupo.png" class="w-4 mr-3" />
						<a href="./integrantes.html" class="text-white max-sm:text-sm">Creadores de la página</a>
					</div>
					<div class="flex items-center">
						<img src="./assets/icon/seguridad.png" class="w-4 mr-3" />
						<a href="#" class="text-white max-sm:text-sm">Politicas de Privacidad</a>
					</div>
				</div>
			</div>
        </div>
        <div class="flex absolute top-3 right-16 max-sm:top-20 space-x-1">
            <a href="">
                <img src="./assets/icon/facebook.png" class="w-8 h-8">
            </a>
            <a href="">
                <img src="./assets/icon/instagram.png" class="w-8 h-8">
            </a>
            <a href="">
                <img src="./assets/icon/tik-tok.png" class="w-8 h-8">
            </a>
        </div>
    </footer>

    <script src="./assets/js/qrcode.js"></script>    
    <script src="./assets/js/header.js"></script>
    
    <script>

        //PONER URL BASE DEL PROYECTO
        let baseUrl = "http://localhost:8080";

        //DEBE APUNTAR al qr_target.html que estará en el SERVER "https://www.ejem.com/qr_target.html" 
        let targetUrl = "./qr_target.html";

        let pruebas;
        function ObtenerCompra(codigoConfirmacion) {

            //recurso en backend
            fetch(baseUrl + '/Cine/datosQr/' + codigoConfirmacion, { method: "Get" }).then(res => {
                res.json()
                    .then(compra => {
                        pruebas = compra;
                        ImprimirCompra(pruebas);

                    });
            });
        }

        function ImprimirCompra(compra) {

            //Mapping
            let confirmacion = document.getElementById("compra-confirmacion");
            let total = document.getElementById("compra-total");

            let sede = document.getElementById("compra-sede");
            let pelicula = document.getElementById("compra-pelicula");
            let sala = document.getElementById("compra-sala");
            let fecha = document.getElementById("compra-fecha");
            let hora = document.getElementById("compra-hora");
            let boletos = document.getElementById("compra-boletos");

            confirmacion.innerHTML = codigoConfirmacion;
            total.innerHTML = compraTotal + ".00";

            sede.innerHTML = compra.sede;
            pelicula.innerHTML = compra.pelicula;
            sala.innerHTML = compra.sala;
            boletos.innerHTML = compra.boletos;
            fecha.innerHTML = compra.fecha;

            // Formatear hora segun las preferencias del usuario (HH:mm)
            let hour = new Date("2023-01-01 " + compra.hora);
            hora.innerHTML = hour.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });


            // Generar QR code
            let qrcode = new QRCode(document.getElementById('compra-qrcode'), {
                text: paginaVideo,
                width: 300,
                height: 300
            });

            //qr clickeable
            let qrlink = document.getElementById("paginaVideo");
            qrlink.href = paginaVideo;

            let qrpic = document.getElementById('compra-qrcode');
            qrpic.classList.add('border-[10px]', 'border-white');
        }

        //Calculo del total de compra
        let compraTotal = ((Number(sessionStorage.adultoCantidad) +
            Number(sessionStorage.ninoCantidad)) * 3)
            + ((Number(sessionStorage.jubiladoCantidad) +
                Number(sessionStorage.discapacitadoCantidad)) * 2)
        //
        let codigoConfirmacion = sessionStorage.codigoConfirmacion;
        let paginaVideo = targetUrl + "?cod=" + codigoConfirmacion;

        ObtenerCompra(codigoConfirmacion);

    </script>
</body>
</html>
